<!DOCTYPE html>
<html>
<body>
  <button id="record">Hold to Record</button>
  <audio id="response" controls></audio>
  
  <script>
    let mediaRecorder;
    let audioChunks = [];
    
    document.getElementById('record').addEventListener('mousedown', async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.start();
    });
    
    document.getElementById('record').addEventListener('mouseup', () => {
      mediaRecorder.stop();
      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        audioChunks = [];
        
        const formData = new FormData();
        formData.append('data', audioBlob);
        
        const response = await fetch('https://light47.app.n8n.cloud/webhook/jarvis-voice', {
          method: 'POST',
          body: formData
        });
        
        const audioResponse = await response.blob();
        document.getElementById('response').src = URL.createObjectURL(audioResponse);
      };
    });
  </script>
</body>
</html>
